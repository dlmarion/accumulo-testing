apiVersion: v1
kind: ConfigMap
metadata:
  name: client-properties
data:
  accumulo-client.properties: |
    instance.name=accumulo-testing
    instance.zookeepers=10.0.2.6:2181
    auth.type=password
    auth.principal=root
    auth.token=secret
    scan.server.dispatcher.opts.maxDepth=1
    scan.server.dispatcher.opts.initialServers=23
    scan.server.dispatcher.opts.initialBusyTimeout=PT0.033S
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-properties
data:
  accumulo-testing.properties: |
    test.common.hdfs.root=hdfs://10.0.2.6:8000
    test.ci.common.accumulo.table=ci
    test.ci.ingest.row.min=0
    test.ci.ingest.row.max=9223372036854775807
    test.ci.query.consistency=eventual
    test.ci.query.row.min=733333333333333e
    test.ci.query.row.max=79999999999999a5
    test.ci.query.prefix.len=4
    test.ci.query.threads=12
    test.ci.query.scans=80000
    test.ci.query.grep=def
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-logging
data:
  log4j2.properties: |
    name = AccumuloTestingDefaultLoggingProperties
    status = info
    dest = err

    appenders = console
    appender.console.type = Console
    appender.console.name = STDERR
    appender.console.target = SYSTEM_ERR
    appender.console.layout.type = PatternLayout
    appender.console.layout.pattern = %d{ISO8601} [%c{3}] %-5p: %m%n

    loggers = accumulotesting, accumulo, hadooptest, hadoopmapred, hadooputil, zookeepertest, curatortest, ciq
    logger.accumulotesting.name = org.apache.accumulo.testing
    logger.accumulotesting.level = DEBUG

    logger.accumulo.name = org.apache.accumulo
    logger.accumulo.level = WARN

    logger.hadooptest.name = org.apache.hadoop
    logger.hadooptest.level = WARN
    logger.hadoopmapred.name = org.apache.hadoop.mapreduce
    logger.hadoopmapred.level = ERROR
    logger.hadooputil.name = org.apache.hadoop.util
    logger.hadooputil.level = ERROR

    logger.zookeepertest.name = org.apache.zookeeper
    logger.zookeepertest.level = ERROR

    logger.curatortest.name = org.apache.curator.test
    logger.curatortest.level = ERROR

    logger.ciq.name = org.apache.accumulo.testing.continuous.ContinuousQuery
    logger.ciq.level = DEBUG

    rootLogger.level = info
    rootLogger.appenderRefs = stderr
    rootLogger.appenderRef.stderr.ref = STDERR
---
apiVersion: batch/v1
kind: Job
metadata:
  name: ssquery
spec:
  parallelism: 16
  completions: 16
  backoffLimit: 4
  template:
    spec:
      nodeSelector:
        agentpool: scanpool
      restartPolicy: Never
      containers:
      - name: ssquery
        image: accumulosst.azurecr.io/sst/accumulo-testing
        command: ["/opt/at/bin/docker-entry"]
        args: ["cingest","query"]
        resources:
          requests:
            cpu: 3
            memory: "1024Mi"
          limits:
            cpu: 3
            memory: "1024Mi"
        volumeMounts:
        - name: "config"
          mountPath: "/opt/at/conf/accumulo-client.properties"
          subPath: "accumulo-client.properties"
        - name: "logging"
          mountPath: "/opt/at/conf/log4j2.properties"
          subPath: "log4j2.properties"
        - name: "test-config"
          mountPath: "/opt/at/conf/accumulo-testing.properties"
          subPath: "accumulo-testing.properties"          
      volumes:
      - name: "config"
        configMap:
          name: "client-properties"
      - name: "logging"
        configMap:
          name: "test-logging"
      - name: "test-config"
        configMap:
          name: "test-properties"

  
